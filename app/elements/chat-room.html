<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="chat-window.html">

<dom-module id="chat-room">
  <template>
    <style include="shared-styles"></style>
    <style>

    .drawerToolbar {
      color: var(--secondary-text-color);
      background-color: var(--drawer-menu-color);
      border-bottom: var(--drawer-toolbar-border-color);
    }

    paper-menu {
      --paper-menu-selected-item: {
        color: var(--primary-color);
      }
      --paper-menu-focused-item-after: {
        background: var(--primary-color);
      }
    }
    paper-menu iron-icon {
      margin-right: 33px;
      opacity: 0.54;
    }
    paper-menu a {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      text-decoration: none;
      color: var(--menu-link-color);
      font-family: 'Roboto', 'Noto', sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      font-size: 14px;
      font-weight: 400;
      line-height: 24px;
      min-height: 48px;
      padding: 0 16px;
    }

    #login {
      position: fixed;
      right: 1em;
      top: 0;
      line-height: 64px;
      text-transform: uppercase;
      color: white;
    }
    </style>

    <paper-drawer-panel>
      <paper-header-panel drawer>
        <a id="login" href="#">Login</a>
        <paper-toolbar class="drawerToolbar">
          <span class="paper-font-title">Chats</span>
        </paper-toolbar>
        <paper-menu id="roomsList" class="list" attr-for-selected="data-route" selected="[[route]]">
          <a data-route="home" href="/">
            <span>Home</span>
          </a>
          <a data-route="chat" href="{{baseUrl}}chat">
            <span>Chat</span>
          </a>
          <a data-route="myroom" href="{{baseUrl}}myroom">
            <span>myroom</span>
          </a>
        </paper-menu>
       <!--  <form on-submit="joinRoom">
          <paper-input id="room" label="Enter room to join"></paper-input>
          <paper-button raised on-tap="joinRoom">Join Room</paper-button>
        </form> -->
      </paper-header-panel>

      <div main>
        <iron-pages attr-for-selected="data-route" selected="[[chatroom]]">
          <template id="repeat" is="dom-repeat" items='{{rooms}}'>
            <section data-route$='{{item}}'>
              <chat-window class$="{{item}}" chatroom="{{item}}" socket='{{socket}}'>{{item}}</chat-window>
            </section>
          </template>
        </iron-pages>
      </div>
    </paper-drawer-panel>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'chat-room',

    properties: {
      chatroom: {
        type: String,
        notify: true
      },
      rooms: {
        type: function() {return []},
        value: ['home', 'chat', 'myroom'],
        observer: 'roomObserver'
      }
    },

    ready: function() {
      document.addEventListener('socket connected', function() {
        this.socket = app.socket
        this.socketListener();
      }.bind(this))

      var obs = new MutationObserver(function(mutations) {
        console.log(mutations);
      })

      obs.observe(this.querySelector('#roomsList'), {
        subtree: true,
        childList: true
      })
    },

    socketListener: function() {
      this.socket.on('join room', function(data, blah) {
        console.log(data, blah);
      })
    },

    joinRoom: function(e, detail) {
      e.preventDefault();
      var room = this.querySelector('#room')
      this.socket.emit('join room', {
        user: app.username,
        room: room.value
      })
      // var updatedRooms = this.rooms.slice();
      // updatedRooms.push(room.value);
      // this.set('rooms', updatedRooms)
      this.push('rooms', room.value)
      room.value = ''
    },

    roomObserver: function() {
      // this.$.repeat.render();
    }
  })
</script>